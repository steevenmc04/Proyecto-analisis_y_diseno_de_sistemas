<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Corporal Gym</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="not-logged" class="welcome-screen">
        <div class="welcome-container">
            <div class="welcome-logo">
                <img src="images/logo.png" alt="Corporal Gym" width="120" height="120">
            </div>
            <h1>¬°Bienvenido al Corporal Gym!</h1>
            <p class="welcome-subtitle">Transforma tu vida, fortalece tu cuerpo, alcanza tus metas</p>
            <div class="welcome-actions">
                <a href="login.html" class="btn-primary">Iniciar Sesi√≥n</a>
                <a href="register.html" class="btn-secondary">Registrarse</a>
            </div>
        </div>
        <div class="welcome-background">
            <div class="floating-elements">
                <div class="floating-icon">üí™</div>
                <div class="floating-icon">üèãÔ∏è</div>
                <div class="floating-icon">üö¥</div>
                <div class="floating-icon">üßò</div>
            </div>
        </div>
    </div>

      <div id="logged" style="display:none;">
    <!-- Bot√≥n toggle para m√≥vil -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay para m√≥vil -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>
    
    <aside class="sidebar">
      <a href="index.html"><img src="images/logo.png" alt="logo" class="menu-icon"></a>
      <h3>Corporal Gym</h3>
      <ul>
        <li><a href="index.html" class="active"><i class="fas fa-home"></i> Inicio</a></li>
        <li><a href="membresias.html"><i class="fas fa-id-card"></i> Membres√≠as</a></li>
        <li><a href="clases.html"><i class="fas fa-dumbbell"></i> Clases</a></li>
        <li><a href="reportes.html"><i class="fas fa-chart-bar"></i> Reportes</a></li>
        <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Salir</a></li>
      </ul>
    </aside>
        
        <main class="dashboard-main">
            <!-- Header con estad√≠sticas r√°pidas -->
            <div class="dashboard-header">
                <div class="welcome-message">
                    <h1>¬°Bienvenido de vuelta!</h1>
                    <p>Tu jornada de fitness contin√∫a. ¬øListo para tu pr√≥ximo entrenamiento?</p>
                </div>
                <div class="quick-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div class="stat-info">
                            <span class="stat-number">150+</span>
                            <span class="stat-label">Miembros Activos</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-info">
                            <span class="stat-number">24/7</span>
                            <span class="stat-label">Horario</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-trophy"></i>
                        <div class="stat-info">
                            <span class="stat-number">50+</span>
                            <span class="stat-label">Clases Semanales</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n de caracter√≠sticas principales -->
            <section class="features-section">
                <h2>¬øPor qu√© elegirnos?</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-dumbbell"></i>
                        </div>
                        <h3>Equipos de √öltima Generaci√≥n</h3>
                        <p>M√°quinas modernas y equipos de cardio de alta calidad para maximizar tu entrenamiento.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <h3>Entrenadores Certificados</h3>
                        <p>Profesionales expertos que te guiar√°n en cada paso de tu transformaci√≥n f√≠sica.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3>Ambiente Motivador</h3>
                        <p>Un espacio dise√±ado para inspirarte y mantenerte comprometido con tus objetivos.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Seguridad Garantizada</h3>
                        <p>Protocolos de higiene y medidas de seguridad para tu tranquilidad.</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de horarios destacados -->
            <section class="schedule-section">
                <h2>Horarios Destacados</h2>
                <div class="schedule-grid" id="scheduleGrid">
                    <!-- Las clases se cargar√°n din√°micamente desde la base de datos -->
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Cargando clases...</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de galer√≠a de fotos -->
            <section class="gallery-section">
                <h2>Galer√≠a del Gym</h2>
                <div class="gallery-grid">
                    <div class="gallery-item">
                        <img src="images/img1.jpg" class="gallery-photo">
                    </div>
                    <div class="gallery-item">
                        <img src="images/img2.jpeg" class="gallery-photo">
                    </div>
                    <div class="gallery-item">
                        <img src="images/img3.png" class="gallery-photo">
                    </div>
                    <div class="gallery-item">
                        <img src="images/img4.png" class="gallery-photo">
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de membres√≠as destacadas -->
            <section class="memberships-section">
                <h2>Membres√≠as Populares</h2>
                <div class="memberships-grid" id="membershipsGrid">
                    <!-- Las membres√≠as se cargar√°n din√°micamente desde la base de datos -->
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Cargando membres√≠as...</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de contacto -->
            <section class="contact-section">
                <div class="contact-info">
                    <h2>¬øNecesitas ayuda?</h2>
                    <p>Nuestro equipo est√° aqu√≠ para ayudarte a alcanzar tus objetivos fitness</p>
                    <div class="contact-details">
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>+(593)96 843 4516</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>fitnesscorporal@hotmail.com</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Corporal Nexus , Guayaquil, Ecuador</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Funci√≥n para verificar autenticaci√≥n
        function checkAuth() {
            const token = localStorage.getItem("token");
            if (token) {
                // Verificar si el token es v√°lido haciendo una petici√≥n al servidor
                fetch('http://localhost:3000/verify-token', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => {
                    if (response.ok) {
                        // Token v√°lido, mostrar dashboard
                        document.getElementById("logged").style.display = "flex";
                        document.getElementById("not-logged").style.display = "none";
                        // Cargar datos del dashboard
                        setTimeout(() => {
                            animateCards();
                            animateStats();
                            loadDashboardData();
                        }, 500);
                    } else {
                        // Token inv√°lido, limpiar y mostrar login
                        localStorage.removeItem("token");
                        document.getElementById("logged").style.display = "none";
                        document.getElementById("not-logged").style.display = "flex";
                    }
                })
                .catch(error => {
                    console.error('Error verificando token:', error);
                    // En caso de error, mostrar login
                    localStorage.removeItem("token");
                    document.getElementById("logged").style.display = "none";
                    document.getElementById("not-logged").style.display = "flex";
                });
            } else {
                // No hay token, mostrar pantalla de login
                document.getElementById("logged").style.display = "none";
                document.getElementById("not-logged").style.display = "flex";
            }
        }
        
        function logout(){
            localStorage.removeItem("token");
            window.location.href="login.html";
        }

        // Animaciones de entrada para las tarjetas
        function animateCards() {
            const cards = document.querySelectorAll('.feature-card, .schedule-card, .membership-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, { threshold: 0.1 });

            cards.forEach(card => observer.observe(card));
        }

        // Contador animado para las estad√≠sticas
        function animateStats() {
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach(stat => {
                const finalNumber = stat.textContent;
                let currentNumber = 0;
                const increment = parseInt(finalNumber) / 50;
                
                const timer = setInterval(() => {
                    currentNumber += increment;
                    if (currentNumber >= parseInt(finalNumber)) {
                        stat.textContent = finalNumber;
                        clearInterval(timer);
                    } else {
                        stat.textContent = Math.floor(currentNumber);
                    }
                }, 50);
            });
        }

        // Cargar datos desde la base de datos
        async function loadDashboardData() {
            try {
                // Cargar clases desde la base de datos
                const clasesResponse = await fetch('http://localhost:3000/clases');
                const clases = await clasesResponse.json();
                console.log('Clases cargadas:', clases);
                displayClases(clases);

                // Cargar membres√≠as desde la base de datos
                const membresiasResponse = await fetch('http://localhost:3000/membresias');
                const membresias = await membresiasResponse.json();
                console.log('Membres√≠as cargadas:', membresias);
                displayMembresias(membresias);

            } catch (error) {
                console.error('Error cargando datos:', error);
                showErrorMessages();
            }
        }

        // Mostrar clases en el dashboard
        function displayClases(clases) {
            const scheduleGrid = document.getElementById('scheduleGrid');
            if (!scheduleGrid) return;

            if (clases.length === 0) {
                scheduleGrid.innerHTML = '<div class="no-data">No hay clases disponibles en este momento</div>';
                return;
            }

            // Seleccionar las 3 mejores clases bas√°ndose en popularidad y horarios
            // Priorizar clases de la ma√±ana y con m√°s d√≠as por semana
            const clasesDestacadas = clases
                .map(clase => {
                    // Calcular puntuaci√≥n basada en horario y frecuencia
                    let puntuacion = 0;
                    
                    // Horario de ma√±ana (m√°s popular)
                    if (clase.horario_inicio && clase.horario_inicio < '12:00:00') {
                        puntuacion += 3;
                    }
                    
                    // Frecuencia de d√≠as por semana
                    if (clase.dias_semana) {
                        const dias = clase.dias_semana.split(',').length;
                        puntuacion += dias;
                    }
                    
                    // Clases populares por nombre
                    const nombresPopulares = ['Yoga', 'Zumba', 'Spinning', 'Crossfit'];
                    if (nombresPopulares.includes(clase.nombre)) {
                        puntuacion += 2;
                    }
                    
                    return { ...clase, puntuacion };
                })
                .sort((a, b) => b.puntuacion - a.puntuacion)
                .slice(0, 3);
            
            scheduleGrid.innerHTML = clasesDestacadas.map(clase => {
                // Formatear horario
                const horarioInicio = clase.horario_inicio ? clase.horario_inicio.substring(0, 5) : '';
                const horarioFin = clase.horario_fin ? clase.horario_fin.substring(0, 5) : '';
                const horarioFormateado = horarioInicio && horarioFin ? `${horarioInicio} - ${horarioFin}` : 'Por definir';
                
                // Formatear d√≠as de la semana
                const diasFormateados = clase.dias_semana ? clase.dias_semana.replace(/,/g, ', ') : '';
                
                return `
                    <div class="schedule-card">
                        <div class="schedule-time">${horarioFormateado}</div>
                        <div class="schedule-info">
                            <h4>${clase.nombre || 'Clase'}</h4>
                            <p>D√≠as: ${diasFormateados}</p>
                            <span class="schedule-trainer">Con ${clase.entrenador || 'Entrenador'}</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Animar las tarjetas despu√©s de cargarlas
            setTimeout(() => animateCards(), 100);
        }

        // Mostrar membres√≠as en el dashboard
        function displayMembresias(membresias) {
            const membershipsGrid = document.getElementById('membershipsGrid');
            if (!membershipsGrid) return;

            if (membresias.length === 0) {
                membershipsGrid.innerHTML = '<div class="no-data">No hay membres√≠as disponibles en este momento</div>';
                return;
            }

            // Seleccionar las 3 mejores membres√≠as bas√°ndose en valor y popularidad
            // Priorizar membres√≠as con mejor relaci√≥n precio-beneficio
            const membresiasDestacadas = membresias
                .map(membresia => {
                    // Calcular puntuaci√≥n basada en precio y caracter√≠sticas
                    let puntuacion = 0;
                    
                    // Membres√≠as premium (m√°s valor)
                    if (membresia.nombre === 'Premium' || membresia.nombre === 'Oro' || membresia.nombre === 'Platino') {
                        puntuacion += 5;
                    }
                    
                    // Membres√≠as con entrenador personal
                    if (membresia.descripcion && membresia.descripcion.includes('entrenador personal')) {
                        puntuacion += 3;
                    }
                    
                    // Membres√≠as con clases grupales
                    if (membresia.descripcion && membresia.descripcion.includes('clases grupales')) {
                        puntuacion += 2;
                    }
                    
                    // Membres√≠as b√°sicas (buena opci√≥n para principiantes)
                    if (membresia.nombre === 'B√°sico' || membresia.nombre === 'Estudiante') {
                        puntuacion += 1;
                    }
                    
                    return { ...membresia, puntuacion };
                })
                .sort((a, b) => b.puntuacion - a.puntuacion)
                .slice(0, 3);
            
            membershipsGrid.innerHTML = membresiasDestacadas.map((membresia, index) => {
                // Determinar cu√°l es la m√°s popular (la de mayor puntuaci√≥n)
                const esMasPopular = index === 0;
                
                return `
                    <div class="membership-card ${esMasPopular ? 'featured' : ''}">
                        ${esMasPopular ? '<div class="membership-badge">M√°s Popular</div>' : ''}
                        <div class="membership-header">
                            <h3>${membresia.nombre || 'Membres√≠a'}</h3>
                            <div class="price">$${membresia.precio || '0'}<span>/mes</span></div>
                        </div>
                        <ul class="membership-features">
                            <li><i class="fas fa-check"></i> ${membresia.descripcion || 'Caracter√≠sticas no disponibles'}</li>
                            <li><i class="fas fa-check"></i> Duraci√≥n: ${membresia.duracion_dias || '0'} d√≠as</li>
                            <li><i class="fas fa-check"></i> Acceso completo al gimnasio</li>
                        </ul>
                        <a href="membresias.html" class="btn-membership">Ver Detalles</a>
                    </div>
                `;
            }).join('');

            // Animar las tarjetas despu√©s de cargarlas
            setTimeout(() => animateCards(), 100);
        }

        // Mostrar mensajes de error
        function showErrorMessages() {
            const scheduleGrid = document.getElementById('scheduleGrid');
            const membershipsGrid = document.getElementById('membershipsGrid');
            
            if (scheduleGrid) {
                scheduleGrid.innerHTML = '<div class="error-message">Error al cargar las clases</div>';
            }
            
            if (membershipsGrid) {
                membershipsGrid.innerHTML = '<div class="error-message">Error al cargar las membres√≠as</div>';
            }
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth(); // Verificar autenticaci√≥n al cargar la p√°gina
        });

        // ====== FUNCIONES PARA SIDEBAR RESPONSIVE ======
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('hidden');
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.remove('active');
            overlay.classList.add('hidden');
        }

        // Cerrar sidebar al hacer clic en un enlace (m√≥vil)
        document.addEventListener('click', (e) => {
            if (e.target.closest('.sidebar a') && window.innerWidth <= 768) {
                closeSidebar();
            }
        });

        // Cerrar sidebar al cambiar tama√±o de ventana
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                
                sidebar.classList.remove('active');
                overlay.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
